$(window).load(function() {
    //브랜드 > 룩북 > 리스트 비대칭
    $('.grid_col2').masonry({
        itemSelector: '.grid_item',
        gutter: 5,
        percentPosition: true
    });
	//쇼윈도 > 리스트 비대칭
    var $gridSwd = $('.swd_grid').masonry({
        itemSelector: '.swd_item',
        percentPosition: true
    });
    $gridSwd.on('click', '.btn_readmore', function() {
        $gridSwd.masonry('layout');
        return false;
    });
});
$(document).ready(function() {
	/* ==============================
		common	
	============================== */
	//resize
    window_resize();
    function window_resize() {
        $("#page").css({ paddingTop: $("#header .header").outerHeight() });
        var pageMinH = $("html").height() - $("#header .header").outerHeight();
        //$("#page").css({ minHeight: pageMinH });
        var contentMinH = pageMinH - $("#footer").outerHeight();
        $("#content").css({ minHeight: contentMinH });
    }
	$(window).resize(function(){
		window_resize();
	});

	//앱 설치 유도 배너 닫기
    $('.top_banner').each(function() {
        var ui = $(this);
        var btnCls = $(this).find('.btn_close');
        btnCls.click(function() {
            ui.hide();
            window_resize()
        })
    });
	//body stop/static
    function bodyStop(){
        var sct = -$(window).scrollTop();
        $('body').addClass('lyr_open');
        $('#page').css('top', sct);
    }
    function bodyStatic(){
        var osc = -$('#page').position().top;
        $('body').removeClass('lyr_open');
        $(window).scrollTop(osc);
    };
	//lnb open/close
    $('.btn-lnb-open').click(function(){
        $('.lnb-layer').addClass('on');
        $('.lnb-layer-inner').stop().animate({left:0},300);
        bodyStop();
    })
    $('.btn-lnb-close, .lnb-layer-dim').click(function() {
        $('.lnb-layer-inner').stop().animate({left:'-100%'},200,function(){
            $('.lnb-layer').removeClass('on');
        });
        bodyStatic();
    });
	//rnb open/close
    $('.btn-rnb-open').click(function(){
        $('.rnb-layer').addClass('on');
        $('.rnb-layer-inner').stop().animate({right:0},300);
        bodyStop();
    })
    $('.btn-lnb-close, .rnb-layer-dim').click(function(){
        $('.rnb-layer-inner').stop().animate({right:'-100%'},200,function(){
            $('.rnb-layer').removeClass('on');
        });
        bodyStatic();
    });
	//lnb category submenu open
    $('.main_category a').click(function() {
        var subMenu = $(this).next('.sub_category');
        if (subMenu.css('display') == 'block'){
            subMenu.hide();
        } else {
            $(this).parent('li').siblings().find('.sub_category').hide();
            subMenu.show();
        }
    });
	//header > search popup
    $('#btn_search').click(function(){
        $('.pop_search').show();
        bodyStop();
    });
    $('.pop_search .close_search').click(function(){
        $('.pop_search').hide();
        bodyStatic();
    });
	// prev, top 버튼 
    $(window).on('scroll', function(){
        if ($(window).scrollTop() >= 80){
            $('.quick_btn_wrap').css('display', 'block');
        } else {
            $('.quick_btn_wrap').css('display', 'none');
        }
    });
    var btnTop = $('.quick_btn_wrap .top_btn');
    btnTop.click(function() {
        $('html, body').animate({scrollTop: 0}, 500);
    });
    if (window.location.href.indexOf("productdetail") > -1) {
        $('.quick_btn_wrap a.prev_btn, .quick_btn_wrap a.top_btn').css('bottom', '45px');
    };

	/* new common(2018-07-25) */
	// LNB open/close
	$('.btn_lnb_open').click(function(){
		$('#lnb_wrp').addClass('on');
		bodyStop();
	})
	$('.btn_lnb_cls, .lnb_dim').click(function(){
		$('#lnb_wrp').removeClass('on');
		bodyStatic();
	});

	// gnb toggle
	$('.gnb').each(function(){
		var gnbMenu = $(this).find('.gnbmenu'),
			subMenu = $(this).find('.sub');
		gnbMenu.click(function(){
			var thisSub = $(this).next('.sub');
			if(thisSub.css('display')=='none'){
				subMenu.slideUp(200).parent('li').removeClass('on');
				thisSub.slideDown(200).parent('li').addClass('on');
			}else{
				thisSub.slideUp(200).parent('li').removeClass('on');
			}
		});
	});

	// header > search popup
	$('.btn_sch_open').click(function(){
		$('.schwrp').show();
		bodyStop();
	});
	$('.schwrp #schLyr_cls').click(function(){
		$('.schwrp').hide();
		bodyStatic();
	});

	// quick(cart,top button)
	$(window).scroll(function(){
		if( $(this).scrollTop() > 300 ) {
			$('.quick_btn_wrp').fadeIn(500);
		}else{ 
			$('.quick_btn_wrp').fadeOut(500); 
		} 
	});
	$('.quick_btn_wrp .btn_top a').click(function() {
		$('html, body').animate({scrollTop: 0}, 500);
	});

	/* ==============================
		component	
	============================== */
	// 탭 메뉴 - 일반형
    $("[data-ui=TabMenu]").each(function() {
        var $ui = $(this);
        var $menu = $ui.find("[data-content=menu]");
        var $content = $ui.find("[data-content=content]");
        $menu.on("click", function(_e) {
            var index = $menu.index(this);
            $menu.removeClass("active").removeAttr("title").eq(index).addClass("active").attr("title", "선택됨");
            $content.removeClass("active").eq(index).addClass("active");
        });
    });
	//파일 첨부
    var fileTarget = $('.filebox .upload-hidden');
    fileTarget.on('change', function() {
        if (window.FileReader) {
            var filename = $(this)[0].files[0].name;
        } else {
            var filename = $(this).val().split('/').pop().split('\\').pop();
        }
        $(this).siblings('.upload-nm').val(filename);
    });
	//이미지 업로드 
    $('.add-image').on('change', function(e) {
        ext = $(this).val().split('.').pop().toLowerCase();
        if ($.inArray(ext, ['gif', 'png', 'jpg', 'jpeg']) == -1) {
            resetFormElement($(this));
            window.alert('이미지 파일이 아닙니다! (gif, png, jpg, jpeg 만 업로드 가능)');
        } else {
            blobURL = window.URL.createObjectURL(e.target.files[0]);
            $(this).parents("li").find('.image_preview img').attr('src', blobURL);
            $(this).parents("li").find('.vi-image').val('');
            $(this).parents("li").find('.image_preview').show();
        }
    });
    $('.image_preview a').bind('click', function() {
        resetFormElement($(this).parents("li").find('.add-image'));
        $(this).parents("li").find('.vi-image').val('');
        $(this).parent().hide();
        return false;
    });
    function resetFormElement(e) {
        e.wrap('<form>').closest('form').get(0).reset();
        e.unwrap();
    }
	//레이어팝업 모음
    $('.pop_layer .btn_close').click(function() {
        $('.pop_layer').hide();
        bodyStatic();
    });
    function popClose() {
        $('.pop_layer').hide();
        bodyStatic();
    };
    $('.btn_qna_list').click(function() {
        $('.layer_qna_list').show();
        bodyStop();
    });
    $('.btn_qna_write').click(function() {
        $('.layer_qna_write').show();
        bodyStop();
    });
    $('.btn_review_write').click(function() {});
    $('.btn_goods_detail').click(function() {
        $('.layer_goods_detail').show();
        bodyStop();
    });
    $('.btn_goods_delivery').click(function() {
        $('.layer_goods_delivery').show();
        bodyStop();
    });
    $('.btn_deli_site').click(function() {
        $('.layer_deli_site').show();
        bodyStop();
    });
    $('.btn_store_info').click(function() {
        $('.layer_store_info').show();
        bodyStop();
    });
    $('.btn_exchange').click(function() {
        $('.layer_exchange').show();
        bodyStop();
    });
    $('.btn_refund').click(function() {
        $('.layer_refund').show();
        bodyStop();
    });
    $('.btn_change_addr').click(function() {
        $('.layer_change_addr').show();
        bodyStop();
    });
    $('.btn_inquiry_write').click(function() {
        $('.layer_inquiry_write').show();
        bodyStop();
    });
    $('.btn_add_deli').click(function() {
        $('.layer_add_deli').show();
        bodyStop();
    });
    $('.btn_photo_submit').click(function() {
        $('.layer_photo_submit').show();
        bodyStop();
    });
    $('.btn_as_write').click(function() {
        $('.layer_as_write').show();
        bodyStop();
    });

	/* new component(2018-07-25) */
	

	// 상세 > 공유하기 팝업
    $('.btn_share').click(function() {
        $('.lyr_share').show();
        bodyStop();
    });
	
	// 상세 > 포토리뷰보기 팝업 slider
	var ptreviewSlider = $('.ptreview_view .slider').bxSlider({
		controls: false,
		preventDefaultSwipeX: false,
		preventDefaultSwipeY: true
	});
	// 상세 > 포토리뷰보기 팝업
    $('.btn_ptreview_view').click(function() {
        $('.layer_ptreview_view').show();
		ptreviewSlider.reloadSlider();
        bodyStop();
    });

	// 장바구니 > 옵션추가팝업
    $('.btn_add_option').click(function() {
        $('.layer_add_option').show();
        bodyStop();
    });

	// 주문하기 > 비회원구매이용약관팝업
	$('.btn_guest_terms').click(function() {
		$('.layer_guest_terms').show();
        bodyStop();
	});

	// 주문하기 > 쿠폰적용팝업
	$('.btn_coupon_use').click(function() {
		$('.layer_coupon_use').show();
        bodyStop();
	});

	// 주문하기 > 주문고객정보변경팝업
	$('.btn_change_buyer').click(function() {
		$('.layer_change_buyer').show();
        bodyStop();
	});

	// 주문하기 > 배송지변경팝업
	$('.btn_change_delivery').click(function() {
		$('.layer_change_delivery').show();
        bodyStop();
	});

	// 주문하기 > 배송지목록팝업
	$('.btn_shipping_list').click(function() {
		$('.layer_shipping_list').show();
        bodyStop();
	});
	
	// 상세 > 쿠폰다운로드팝업
	$('.btn_coupon_down').click(function() {
		$('.layer_coupon_down').show();
        bodyStop();
	});

	// tooltip close
	$('.tooltip').each(function(){
		var cover = $(this).find('.cover');
		var btnOpen = $(this).find('.btn_help');
		var btnCls = $(this).find('.btn-close');
		btnOpen.click(function(){
			cover.show();
		});
		btnCls.click(function(){
			cover.hide();
		});
	});

	//Attention
	$('.attention .show').click(function(){
		$(this).parent().parent().toggleClass('active');
		$(this).parent().next().slideToggle();
	})

	/* ==============================
		content	
	============================== */
	//메인/리스트/상세
	var mainSlider=$('.main_visual .slide');mainSlider.bxSlider({controls:false,auto:true,pause:5000,onSlideAfter:function(){mainSlider.startAuto()}});$('.new_arrivals .goodslist').bxSlider({controls:false,slideWidth:320,minSlides:2,maxSlides:2,moveSlides:2,auto:true,pause:5000});$('.best_slider').carousel({num:3,maxWidth:135,maxHeight:200,distance:80,autoPlay:true,scale:0.9,animationTime:500,showTime:5000});$('.btm_banner .slide').bxSlider({controls:false});$('.breadcrumb').each(function(){var bread=$(this);var list_d2=$(this).find('.depth2 > li');var a_d2=list_d2.children('a');var cls=$(this).find('.dimm_bg');a_d2.click(function(){var prtLi=$(this).parent('li');var nxtD3=$(this).next('.depth3');if(nxtD3.css('display')=='none'){list_d2.removeClass('on');prtLi.addClass('on');bread.addClass('on');$('html,body').css({'position':'fixed','overflow':'hidden'})}else{prtLi.removeClass('on');bread.removeClass('on');$('html,body').css({'position':'static','overflow':'visible'})}});cls.click(function(){list_d2.removeClass('on');bread.removeClass('on');$('html,body').css({'position':'static','overflow':'visible'})})});$('.btn_filter').click(function(){$('.filter_pop').show();$('html,body').css({'position':'fixed','overflow':'hidden'})});$('.filter_pop .btn_close').click(function(){$('.filter_pop').hide();$('html,body').css({'position':'static','overflow':'visible'})});$('.filter_menu .filter_name').click(function(){var filterMenu=$(this).parent('li');if($(this).next('.filter_con').css('display')=='none'){filterMenu.addClass('on')}else{filterMenu.removeClass('on')}});$('.detail_img .slide').bxSlider({controls:false});$('.goods_order .btn_addcart').on('click',function(){var goodsOrder=$(this).parents('.goods_order');if(goodsOrder.hasClass('on')){addCart()}else{goodsOrder.addClass('on');bodyStop()}});$('.goods_order .btn_ordernow').on('click',function(){var goodsOrder=$(this).parents('.goods_order');if(goodsOrder.hasClass('on')){directOrder()}else{goodsOrder.addClass('on');bodyStop()}});$('.goods_order .staff_buy').on('click',function(){var goodsOrder=$(this).parents('.goods_order');if(goodsOrder.hasClass('on')){directOrder('staff')}else{goodsOrder.addClass('on');bodyStop()}});$('.goods_order .bg, .select_shipping > .btn_close').click(function(){$(this).parents('.goods_order').removeClass('on');bodyStatic()});$('.wrap_bubble').each(function(){var wrapBubble=$(this);var btnBubble=$(this).find('.btn_bubble');var popBubble=$(this).find('.pop_bubble');btnBubble.children('button').click(function(){$('.wrap_bubble').removeClass('on');$('.pop_bubble').hide();wrapBubble.addClass('on');popBubble.show()});popBubble.find('.btn_pop_close').click(function(){wrapBubble.removeClass('on');popBubble.hide()})});$('.list_store > li').each(function(){var btnMap=$(this).find('.btn_map');var mapArea=$(this).find('.map_area');btnMap.click(function(){if(mapArea.css('display')=='none'){btnMap.addClass('on');btnMap.text('지도닫기');mapArea.show()}else{btnMap.removeClass('on');btnMap.text('지도보기');mapArea.hide()}})});if(window.location.href.indexOf("goodsdetail")>-1){$('#footer').css('padding-bottom','40px')};
	//회원가입 > 약관동의 > 전체선택/해제
    $('.join_form').each(function() {
        var agreeAll = $(this).find('#checkAll');
        var agree = $(this).find('.check_def').not(agreeAll);
        agreeAll.on('change', function(_e) {
            if ($(this).is(':checked')) agree.prop('checked', true);
            else agree.prop('checked', false);
        });
        agree.on('change', function(_e) {
            var count = agree.filter(':checked').length;
            if (agree.length == count) agreeAll.prop('checked', true);
            else agreeAll.prop('checked', false);
        });
    });
	//마이페이지 > 쿠폰 > 적용대상 토글
    $('.mypage_coupon .list_coupon li').each(function() {
        var cList = $(this);
        var btnTarget = $(this).find('.target');
        var targetMore = $(this).find('.target_more');
        btnTarget.click(function() {
            if (targetMore.css('display') == 'none') {
                cList.addClass('on');
            } else {
                cList.removeClass('on');
            }
        });
    });
	//마이페이지 > 완료리뷰, 상품문의 1:1문의
    $('.accordion_list > li').each(function() {
        var acdnList = $(this);
        var acdnBtn = $(this).find('.accordion_btn');
        var acdnCon = $(this).find('.accordion_con');
        acdnBtn.click(function() {
            if (acdnCon.css('display') == 'none') {
                acdnList.siblings('li').removeClass('on');
                acdnList.addClass('on');
            } else {
                acdnList.removeClass('on');
            }
        });
    });
	//마이페이지 > 1:1문의 > 파일첨부
    var fileTarget = $('.input_file .upload_hidden');
    fileTarget.on('change', function() {
        if (window.FileReader) {
            var filename = $(this)[0].files[0].name;
        } else {
            var filename = $(this).val().split('/').pop().split('\\').pop();
        }
        $(this).siblings('.upload_name').val(filename);
    });
	//프로모션 > 이벤트, 기획전 슬라이드
    $('.promotion .topbanner .slide').bxSlider({
        controls: false,
		auto: true
    });
	//프로모션 > 기획전 > 상세 슬라이드
    $('.prgoods_detail.slider').bxSlider({
        pager: false,
        infiniteLoop: false,
        responsive: true
    });
	//쇼윈도 > 상품설명 더보기 토글
    $('.list_showindow .goods_area').each(function() {
        var wrapGoods = $(this);
        var btnMore = $(this).find('.btn_readmore');
        btnMore.click(function() {
            if (wrapGoods.hasClass('on')) {
                wrapGoods.removeClass('on');
                btnMore.text('더보기');
            } else {
                $('.list_showindow .goods_area').removeClass('on');
                wrapGoods.addClass('on');
                btnMore.text('닫기');
            }
        });
    });
	//고객센터 > FAQ
    $('.accordion_tbl').each(function() {
        var acdnTbl = $(this);
        var acdnTblBtn = $(this).find('.accordion_btn');
        var acdnTblCon = $(this).find('.accordion_con');
        acdnTblBtn.click(function() {
            var nextCon = $(this).parents('tr').next('.accordion_con');
            if (nextCon.css('display') == 'none') {
                acdnTblCon.hide();
                nextCon.show();
            } else {
                nextCon.hide();
            }
        });
    });
});